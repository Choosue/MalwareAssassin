#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from xml.parsers.expat import ParserCreate

class AndroidManifestSaxHandler(object):
    """docstring for AndroidManifestSaxHandler"""
    def __init__(self):
        self.__tagname = ''        # current tag name
        self.__isintent = False    # is current tag in intent

        # Features
        self.__permissions = []    # permission list
        self.__packagename = ''    # package name
        self.__usesfeatures = []   # uses-feature
        self.__activities = []     # activity name list
        self.__intentfilters = []  # intent filter

    def start_element(self, name, attrs):
        # extract permission
        if name == 'uses-permission':
            self.__permissions.append(attrs['android:name'])

        # extract package name
        if name == 'manifest':
            self.__packagename = attrs['package']

        # extract uses-feature
        if name == 'uses-feature':
            self.__usesfeatures.append(attrs['android:name'])

        # extract activity name
        if name == 'activity':
            self.__activities.append(attrs['android:name'])

        # extract intent filter
        if name == 'intent-filter':
            self.__isintent = True
        if name == 'category' and self.__isintent:
            self.__intentfilters.append(attrs['android:name'])
        if name == 'action' and self.__isintent:
            self.__intentfilters.append(attrs['android:name'])

    def end_element(self, name):
        if name == 'intent-filter':
            self.__isintent = False

    def char_data(self, text):
        pass

    def get_permissions(self):
        return self.__permissions

    def get_packagename(self):
        return self.__packagename

    def get_usesfeatures(self):
        return self.__usesfeatures

    def get_activities(self):
        return self.__activities

    def get_intentfilters(self):
        return self.__intentfilters
        
################################################################################
# Read AndroidManifest.xml
# into xml
################################################################################
f = open('camerashow1.0/AndroidManifest.xml')
xml = f.read()
f.close()

################################################################################
# Parse xml by SAX
################################################################################
handler = AndroidManifestSaxHandler()
parser = ParserCreate()
parser.StartElementHandler = handler.start_element
parser.EndElementHandler = handler.end_element
parser.CharacterDataHandler = handler.char_data
parser.Parse(xml)
print(handler.get_permissions())
print(handler.get_packagename())
print(handler.get_usesfeatures())
print(handler.get_activities())
print(handler.get_intentfilters())