#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from xml.parsers.expat import ParserCreate

class AndroidManifestSaxHandler(object):
    """docstring for AndroidManifestSaxHandler"""
    def __init__(self):
        self.__tagname = ''      # current tag name
        self.__permissions = []  # permission list

    def start_element(self, name, attrs):
        if name == 'uses-permission':
            self.__permissions.append(attrs['android:name'])
        # print('sax:start_element: %s, attrs: %s' % (name, str(attrs)))

    def end_element(self, name):
        # print('sax:end_element: %s' % name)
        pass

    def char_data(self, text):
        # print('sax:char_data: %s' % text)
        pass

    def get_permissions(self):
        return self.__permissions
        
################################################################################
# Read AndroidManifest.xml
# into xml
################################################################################
f = open('camerashow1.0/AndroidManifest.xml')
xml = f.read()
f.close()

################################################################################
# Parse xml by SAX
################################################################################
handler = AndroidManifestSaxHandler()
parser = ParserCreate()
parser.StartElementHandler = handler.start_element
parser.EndElementHandler = handler.end_element
parser.CharacterDataHandler = handler.char_data
parser.Parse(xml)
print(handler.get_permissions())